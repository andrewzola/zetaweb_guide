# Яндекс.Касса (Yandex.Kassa)

## Яндекс.Касса  <a href="#yandeks-kassa" id="yandeks-kassa"></a>

### Описание  <a href="#opisanie" id="opisanie"></a>

Поддерживаемые виды оплат:

* **Банковская карта.**

Поддерживаемые онлайн-кассы (ФЗ-54)

* **АТОЛ;**
* **Orange Data;**
* **МодульКасса;**
* **Бизнес.Ру Онлайн-Чеки.**

### Настройка  <a href="#nastroika" id="nastroika"></a>

#### Личный кабинет Яндекс.Касса  <a href="#lichnyi-kabinet-yandeks-kassa" id="lichnyi-kabinet-yandeks-kassa"></a>

В личном кабинете Яндекс.Касса настройте следующие обязательные поля:

* Название сайта _Значение: Полный адрес сайта магазина, включая протокол, например,_ [https://mysite.com](https://mysite.com/)​
* Способ подключения к Яндекс.Кассе _Значение:_ _**HTTP**_
* chekUrl _Значение:_ https://{адрес _**вашего сайта}/mvcget/onlinepayment/validate/**, где {адрес вашего сайта}, например,_ _**mysite.com**_
* avisoUrl _Значение:_ https://{адрес _**вашего сайта}/mvcget/onlinepayment/confirm/,**_ _где {адрес вашего сайта}, например,_ _**mysite.com**_
* shopSuccessUrl, shopFailUrl _Значение:_ _**dynamic**_
* shopPassword _Значение: Любой_ _**пароль**_ _(в дальнейшем он понадбится при настройке 1С)_
* Почта для реестров _Значение: Адрес электронной почты, на которую будут высылаться ежедневные реестры по проведенным платежам_

#### 1С Предприятие  <a href="#id-1s-predpriyatie" id="id-1s-predpriyatie"></a>

Если ваша онлайн-касса поддерживает интеграцию с Яндекс.Кассой, также заполните следующие параметры

* **Отправка данных для чека** - _время в днях, отведенное на отправку данных об электронном чеке, например,_ _**3 дня**_
* **Тип онлайн кассы** _- тип вашей онлайн-кассы, например,_ _**МодульКасса**_
* **Почта для ошибок** _- адрес электронной почты, на который будут отправляться уведомления в случае возникновения ошибок;_
* **Адрес в чеке** _- адрес сайта, отображаемый в чеке, например,_ _**mysite.com**_

<div align="center">

<img src="https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LDkZZ4KLHlNn6g8TQlV%2F-LEPi9C002O2y32na98P%2F-LEPiCrZRdafGpboDYlj%2FImage%2033.png?alt=media&#x26;token=f40459c2-a8b1-46b9-948b-f9c57f9054af" alt="">

</div>

В меню _**1С Предприятие**_ откройте форму _**Настройки платежных систем**_​ _(Zeta Web → Настройки и администрирование → Настройки оплаты, прайс-листы, YML)._

В открывшейся форме добавьте новый элемент и заполните следующие поля:

* **Наименование:** _Значение: Произвольное, понятное вам название настройки_
* **Платежная система:** _Значение:_ _**Яндекс.Деньги**_
* **Договор эквайринга:** _Значение: Существующий или создайте новый договор эквайринга с поставщиком._
* **Идентификатор магазина:** _Значение: Значение настройки_ _**shopId**, выданной вам компанией Яндекс.Касса_
* **Идентификатор витрины магазина:** _Значение: Значение настройки_ _**scid**, выданной вам компанией_ _Яндекс.Касса_
* **Логин:** _Значение: Оставьте это поле_ _**пустым**_
* **Пароль:** _Значение:_ _**Пароль**, указанный в настройках магазина в личном кабинете Яндекс.Касса_
* **Требуется защищенное соединение:** _Значение:_ _**Да**_
* **Тестовый режим оплаты:** _Значение:_ _**Да**_ _- в режиме тестирования;_ _**Нет**_ _- в режиме реальной работы_
* **Адрес платежного шлюза (URL):** _Значение: Оставьте это поле_ _**пустым**_
* **Список видов оплат:** _Значение: Добавьте в список предопределенный вид оплаты_ _**Банковской картой на сайте**, затем откройте данный вид оплаты на редактирование и укажите в нем требуемый_ _**Вид оплаты чека ККМ**, который будет подставляться в документ_ _**Оплата от покупателя платежной картой**_

Если ваша онлайн-касса поддерживает интеграцию с Яндекс.Кассой, также заполните следующие параметры:

* **Использовать онлайн-кассу:** _Значение:_ _**Да**_
* **Идентификатор клиента для онлайн-кассы по умолчанию:** _Значение:_ _**Сначала телефон**_ _- если необходимо высылать данные об электронном чеке в виде SMS;_ _**Сначала электронная почта**_ _- если необходимо высылать данные об электронном чеке на электронную почту покупателя._

​![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LDkZZ4KLHlNn6g8TQlV%2F-LEOh8eMbLiQqSjF90kh%2F-LEPJG22YrU0xaqzkN22%2Fimage.png?alt=media\&token=6e1ad851-9962-46ab-a50d-ffc452d941c1)​![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LDkZZ4KLHlNn6g8TQlV%2F-LEOh8eMbLiQqSjF90kh%2F-LEPJn2kXXKTX11QEeV\_%2Fimage.png?alt=media\&token=e2a374bf-6ae6-4245-98e9-ca0a1e2e7973)

### Переключение на Яндекс.API 3.0 (с поддержкой ФФД 1.05)

Для переключения новое API Яндекс-касс необходимо выполнить следующую последовательность действий:

1. Написать / позвонить в Яндекс-Кассы, чтобы вас переключили на API 3.0. Менеджер компании вышлет Вам анкету, которую необходимо заполнить.   Конечным результатом будет выслано подтверждение перехода на другое API, способ подключения в вашем личном кабинете в результате должен быть: протокол API.&#x20;
2. Настройка Яндекс-Касс:
3. Установите адрес для уведомлений: [https://ваш\_сайт.ru/mvcget/onlinepayment/confirm/](https://xn--\_-7sbbf2b7bj7b.ru/mvcget/onlinepayment/confirm/)
4. Сгенерируйте секретный ключ.  **Важно!** Перед подтверждением его необходимо сохранить. Это ваш пароль, который надо будет указать в качестве пароля в настройках платежной системы в 1С.
5. Настройте параметры в 1С:
   * Перейдите в меню "Зета Веб - Настройки и администрирование - Настройки оплаты, прайс-листы, YML - Настройки платежных систем".
   * Создайте новую настройку платежной системы, в которой укажите платежную систему: Яндекс.Деньги API 3.0
   * Введите Ваш логин и пароль, где:
     * Логин: shopID
     * Пароль: секретный ключ.
   * Установите флаг SSL соединения.

Настройка завершена.

{% hint style="info" %}
**Последовательность прохождения онлайн-платежа:**

1. Пользователь оплачивает заказ в системе Zeta Web.
2. Яндекс.Кассы списывают деньги.
3. Яндекс.Кассы отправляют данные в онлайн-кассу.
4. После получения положительного ответа от онлайн-кассы Яндекс.Кассы отправляют запрос (уведомление) в систему Zeta Web.
5. При получении запроса (уведомления) от Яндекс.Касс система Zeta Web создает документ "Оплата платежной картой".

Если создания документов не происходит, а в личном кабинете Яндекс.Касс написано, что оплата находится в статусе "Ожидает подтверждения", то, вероятно, онлайн-касса не подтвердила платеж.

Проверьте, полностью ли совпадают данные в личном кабинете Яндекс.Касс и настройках Вашей онлайн-кассы (например, для касс Атол поле адрес расчета должно совпадать до символа).

Если вы, по каким-либо причинам, вручную подтвердили платеж в личном кабинете Яндекс.Касс, то сформировать документ "Оплата платежной картой" в 1С также необходимо вручную. После обмена сумма будет учтена во взаиморасчетах.
{% endhint %}
